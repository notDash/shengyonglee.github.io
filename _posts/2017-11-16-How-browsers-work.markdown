---
layout: default
title:  "浏览器是如何工作的!"
date:   2017-11-16 16:17:56 +0800
categories: jekyll update
---
## {{page.title}}  

* [1. 介绍](#1)  
    * [1.1 本文涉及到的浏览器](#1.1)  
    * [1.2 浏览器的主要功能](#1.2)  
    * [1.3 浏览器的主要结构](#1.3)  
    * [1.4 组件之前的通信](#1.4)  

* [2. 渲染引擎](#2)
    * [2.1 渲染引擎](#2.1)
    * [2.2 主要的流程](#2.2)
    * [2.3 流程示例](#2.3)
    * [2.4 解析以及DOM树的结构](#2.4)
    * [2.5 渲染树(Render tree)的结构](#2.5)
    * [2.6 布局](#2.6)
    * [2.7 绘制（Painting）](#2.7)
    * [2.8 动态改变](#2.8)
    * [2.9 渲染引擎的线程](#2.9)
    * [2.10 css2 虚拟模型](#2.10)
    * [2.11 资源](#2.11)  


<span id="1"><b>1. 介绍</b></span>  

浏览器可谓是使用最广泛的软件. 这篇文章我将要解释浏览器在底层是如何工作的. 我们将会了解当你在浏览器地址栏里输入'google.com'直到页面呈现出来这一过程都发生了什么。

<span id="1.1"><b>1.1 本文涉及到的浏览器</b></span>  

目前市面上主要有5款浏览器： Internet Explorer, Firefox, Safari, Chrome 以及 Opera。
我将使用开源的浏览器中进行举例，包含Firefox, Chrome 以及 部分开源的Fafari。
根据[W3C browser statistics](http://www.w3schools.com/browsers/browsers_stats.asp), 当前时间是2009年10月，使用Firefox, Safari 以及 Chrome 的比例占据将近60%。
所以目前开源浏览器占据的浏览器市场很大的份额。

<span id="1.2"><b>1.2 浏览器的主要功能</b></span>  

浏览器的主要功能是把你从服务器请求到的网络资源呈现在浏览器窗口上。资源通常包含了HTML，PDF， 图片等等。资源通常是由用户指定的URI(Unifor resource Identifier 统一资源定位符)来定位的。稍后的章节会介绍。

浏览器解释和呈现HTML文件的方式是通过HTML和CSS规范来实现的。 这些规范是由W3C组织进行维护的，该组织是互联网的标准制定者。长久以来各个浏览器厂商只实现了一部分规范，并且开发自己的扩展程序。这导致了在不同的浏览器当中很严重的兼容性问题。到目前为止，大部分的浏览器都大多实现了规范。
不同的浏览器UI有很多相同的部分:  
* 输入URI的地址栏  
* 前进和后退按钮  
* 书签操作  
* 操作当前加载文档的刷新和停止按钮  
* 返回主页的主页按钮  

但是比较奇怪的是， 浏览器的UI并没有一个通用的规范，它只是不同的浏览器厂商从长期的使用习惯中积累的经验。HTML5规范并没有规定浏览器的UI必须包含哪些元素，只是列出了一些通用的元素。地址栏、状态栏、工具栏以及各个浏览器指定的特定，例如Firefox的下载管理。更多参见用户界面章节。

<span id="1.3"><b>1.3 浏览器的主要结构</b></span> 

浏览器的主要组成部分:  
    1. 用户界面(The user interface) - 包含地址栏、前进/后退按钮、书签等等。除了主要的窗口之外你所看到的就是请求的页面。  
    2. 浏览器引擎 - 查询和操作渲染引擎的入口。  
    3. 渲染引擎 - 负责呈现请求内容。例如请求内容是HTML, 渲染引擎负责解析HTML以及CSS，并且渲染解析后的内容到屏幕上。  
    4. 网络链接 - 处理形如HTTP的网络请求。它有针对不同平台的实现接口。  
    5. 用户界面的后台处理程序(UI Backend) - 用于绘制类似于 bombo 盒子的小部件以及一些窗口。它抛出了各个平台通用的接口。它的底层是使用了操作系统的用户界面方法。  
    6. Javascript 解释器。 用于解析和执行Javascrip代码。  
    7. 数据存储。 这是一个持久层。浏览器需要在硬盘上保存各种各样的数据，比如coocies。HTNL5规范定义了'web database',针对浏览器的完整的数据库（尽管比较轻量）  
    ![浏览器主要组成部分](/images/layers.png)  
        Figure 1: Browser main components.  

值得注意的是，Chrome不像其他的浏览器， 它给每一个tab分配一个渲染引擎的实例，每一个tab都是一个独立的进程。

<span id="1.4"><b>1.4 组件间的通信</b></span>  

Firefox 和 Chrome 都独自开发了一套特别的通信机制。

<b>渲染引擎</b>  

渲染引擎的职责就是进行渲染， 也就是负责把请求到的内容呈现在浏览器屏幕上。


... 未完待续
